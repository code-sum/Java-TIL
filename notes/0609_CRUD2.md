# âœ… CRUD - II

> - í•™ìŠµëª©í‘œ : ì „ìì •ë¶€í‘œì¤€ í”„ë ˆì„ì›Œí¬(eGovFramework)ë¡œ ì œì‘ëœ í”„ë¡œì íŠ¸ì—ì„œ CRUD êµ¬í˜„í•˜ëŠ” ë¡œì§ì„ ë°°ì›€
>
> 1. ê°œë°œìˆœì„œ ê°œìš”
> 2. ê²Œì‹œê¸€ CRUD
> 3. íŒŒì¼ CRUD
>
> ğŸ’¡(ë³¸ ë¬¸ì„œëŠ” ê²Œì‹œê¸€ CRUD - CREATE, UPDATE, DELETE ê¹Œì§€ë§Œ ì‘ì„±, ë‚˜ë¨¸ì§€ íŒŒì¼  CRUD ëŠ” ë‹¤ìŒ ë¬¸ì„œì¸ CRUD - III ì—ì„œ ë‹¤ë£¸)





2-2-2. CREATE

- JSPë‹¨ (`/view/mngNot/noticelist.jsp`)

  >  CREATE, UPDATE, DELETE ê¸°ëŠ¥ êµ¬í˜„ì„ ìœ„í•´, íŒì—…ì°½ ë¨¼ì € ë‹¤ë“¬ì–´ ë†“ê¸°

  - JSP íŒŒì¼ì—ì„œ [ì‹ ê·œë“±ë¡] ë²„íŠ¼ href ì— ì»¤ìŠ¤í…€ ì œì‘í•  function name ì…ë ¥

    ```jsp
    <a class="btnType blue" href="javascript:fn_openpopup();" name="modal"><span>ì‹ ê·œë“±ë¡</span></a>
    ```

  - ê°™ì€ íŒŒì¼ `<script>` ì— `function fn_openpopup()` ìƒˆë¡œ ì‘ì„±

    - ê¸°ë³¸ ê³¨ê²©ì€ í”„ë¡œì íŠ¸ ë‚´ì— ë¯¸ë¦¬ ë§Œë“¤ì–´ì§„ `function gfModalPop()` ì°¸ì¡°

      ![0609_Modal_Popup](0609_CRUD2.assets/0609_Modal_Popup.PNG)

  - Toad ì¼œì„œ CREATE ì‘ì—…ê²°ê³¼ ì–´ë–¤ í…Œì´ë¸”ì˜, ì–´ë–¤ ì»¬ëŸ¼ì„ ì±„ìš°ê²Œ ë  ê²ƒì¸ì§€ í‚¤ì›Œë“œ ë¯¸ë¦¬ ì •ë¦¬

  - JSP íŒŒì¼ì—ì„œ íŒì—…ë  ëª¨ë‹¬ì°½ ë¶€ë¶„ì— `<tbody>` ë‚´ë¶€ë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ì€ëŒ€ë¡œ ìˆ˜ì •

    - í•˜ìœ„ íƒœê·¸ì˜ id, name ë„ êµ¬í˜„í•˜ê³  ìˆëŠ” ê°’ì— ë§ê²Œ ìˆ˜ì •

      ```jsp
      <tbody>
          <tr>
              <th scope="row">ì œëª© <span class="font_red">*</span></th>
              <td colspan="3"><input type="text" class="inputTxt p100" name="notice_title" id="notice_title" /></td>
          </tr>
          <tr>
              <th scope="row">ë‚´ìš© <span class="font_red">*</span></th>
              <td colspan="3">
                  <textarea id="notice_cont" name="notice_cont"> </textarea>
              </td>
          </tr>
      </tbody>
      ```

  - ë²„íŠ¼ ê¸°ëŠ¥í•˜ëŠ” `<div>` , `<a>` id ë„ ì „ë¶€ ìˆ˜ì •

    ```jsp
    <div class="btn_areaC mt30">
        <a href="" class="btnType blue" id="btnSave" name="btn"><span>ì €ì¥</span></a> 
        <a href="" class="btnType blue" id="btnDelete" name="btn"><span>ì‚­ì œ</span></a> 
        <a href=""	class="btnType gray"  id="btnClose" name="btn"><span>ì·¨ì†Œ</span></a>
    </div>
    ```

  - `<script>` ë²„íŠ¼ ì´ë²¤íŠ¸ ê´€ë¦¬í•˜ëŠ” ì½”ë“œë„ ì¡°ê±´ì— ë§ê²Œ ìˆ˜ì •

    ```javascript
    /** ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ */
    
    function fRegisterButtonClickEvent() {
        $('a[name=btn]').click(function(e) {
            e.preventDefault();
    
            var btnId = $(this).attr('id');
    
            switch (btnId) {
                case 'btnSearch' :
                    fn_noticelist();
                    break;
                case 'btnSave' :
                    fn_save();
                    break;	
                case 'btnDelete' :
                    $("#action").val("D");	
                    fn_save();
                    break;	
                case 'btnClose' :
                case 'btnCloseDtlCod' :
                    gfCloseModal();
                    break;
            }
        });
    }
    ```

  - [ì‹ ê·œë“±ë¡] ëª¨ë‹¬ì°½ì´ë¯€ë¡œ í™”ë©´ ì´ˆê¸°í™” ë¡œì§ì„ êµ¬í˜„í•´ì•¼í•˜ê³ , [ì‚­ì œ] ë²„íŠ¼ ìˆ¨ê¹€ì²˜ë¦¬ë„ ì§„í–‰

    - í™”ë©´ ì´ˆê¸°í™” ë¡œì§ì€ `function fn_openpopup()` ë‚´ë¶€ì— `popupinit();` ì‘ì„±í•´ë†“ê³ , ë°”ê¹¥ ë‹¨ì— `function popupinit(object)` ìƒˆë¡œ ì‘ì„± (ì œì´ì¿¼ë¦¬ ë¬¸ë²• í™œìš©í•´ì„œ íŒì—…ì°½ ì´ˆê¸°í™” ë¡œì§ ì¶”ê°€)
    
      ```javascript
      function fn_openpopup() {
      		
          popupinit();
      
          // ëª¨ë‹¬ íŒì—…
          gfModalPop("#layer1");
      
      }
      ```
    
      ```javascript
      function popupinit(object) {
      		
          if(object == "" || object == null || object == undefined) {
              $("#notice_title").val("");		
              $("#notice_cont").val("");
              $("#notice_no").val("");
      
              $("#btnDelete").hide();
      
              // object ê°€ ì—†ëŠ” ìƒíƒœë¡œ íŒì—… ëœ° ë•, action ì„ â€œIâ€ ë¡œ ì„¤ì •í•˜ì—¬  INSERT
              $("#action").val("I");	
          } else {
              $("#notice_title").val(object.notice_title);		
              $("#notice_cont").val(object.notice_cont);
              $("#notice_no").val(object.notice_no);
      
              $("#btnDelete").show();
      
              // object ê°€ ìˆëŠ” ìƒíƒœë¡œ íŒì—… ëœ° ë•, action ì„ â€œUâ€ ë¡œ ì„¤ì •í•˜ì—¬  UPDATE
              $("#action").val("U");	
          }
      }
      ```
    
    - [ì‚­ì œ] ë²„íŠ¼ idëŠ” btnDelete ë¡œ ì¤¬ëŠ”ë°, ì´ˆê¸°í™”ëœ íŒì—…ì°½(ì‹ ê·œë“±ë¡)ì—ì„œ ì‚­ì œ ê¸°ëŠ¥ì€ í•„ìš” ì—†ìœ¼ë‹ˆê¹Œ `function popupinit()` ì•ˆì— `$("#btnDelete").hide();` ì…ë ¥í•˜ì—¬ í™”ë©´ì—ì„œ ìˆ¨ê¹€ ì²˜ë¦¬
    
    - ë™ì¼í•œ íŒì—…ì°½ì„ í™œìš©í•˜ì—¬ [ì‹ ê·œë“±ë¡], [ìˆ˜ì •] ê¸°ëŠ¥ì„ ë™ì‹œì— êµ¬í˜„í•˜ê¸°ìœ„í•´, JSP íŒŒì¼ `<form>` ë‚´ë¶€ ìµœìƒë‹¨ì— hidden ë§Œë“¤ê¸° 
    
      > `id="action"` ì€ `$("#action").val("I");` , `$("#action").val("U");	` ê³¼ ê°™ì´ ì œì´ì¿¼ë¦¬ë¡œ í™œìš©í•˜ê¸° ìœ„í•´ ê¸°ì…
      >
      > `name="action"` ì€ ì¶”í›„ `.serialize() ` í™œìš©í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ ê¸°ì…í•œ ê²ƒ, `.serialize()` ëŠ” `<form>` ì´í•˜ ë‹¨ì— name ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ì…ë ¥í•œ ë°ì´í„°ë“¤ë§Œ í•œêº¼ë²ˆì— ë‹¤ë£° ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ”  ë§¤ì„œë“œ (íŒŒë¼ë¯¸í„° ì„ ì–¸ ê³¼ì •ì—ì„œ ì „ë‹¬í•  ìš”ì†Œê°€ ë„ˆë¬´ ë§ì•„ì„œ í•˜ë‚˜ì”© ì…ë ¥í•˜ê¸° í˜ë“¤ ë•Œ í™œìš©)
    
      ```jsp
      <body>
      <form id="myForm" action=""  method="">
      	<input type="hidden" id="action"  name="action"  />
          ...
      ```



---



2-2-3. UPDATE & DELETE

> ê²Œì‹œê¸€ ëª©ë¡ì—ì„œ ì œëª©ì„ í´ë¦­í–ˆì„ ë•Œ, í•œê±´ ì¡°íšŒ(ê¸€ ìƒì„¸í˜ì´ì§€ íŒì—…) ê°€ëŠ¥í•˜ë„ë¡ ê¸°ëŠ¥ êµ¬í˜„
>
> ê°™ì€ íŒì—…ì°½ì—ì„œ UPDATE & DELETE ê¸°ëŠ¥ ëª¨ë‘ êµ¬í˜„

- JSPë‹¨ (`/view/mngNot/noticelistgrd.jsp`)

  - [ì œëª©] ì„ ë³´ì—¬ì£¼ëŠ” `<tb>` ë‚´ë¶€ `<a>` href ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •

    ```jsp
    <td>
        <a href="javascript:fn_selectone('${list.notice_no}')">${list.notice_title}</a>
    </td>
    ```

- JSPë‹¨ (`/view/mngNot/noticelist.jsp`)

  - `function fn_selectone(no)` ì‘ì„±

    ```javascript
    function fn_selectone(no) {
    		
        //alert(no);
    
        var param = {
            notice_no : no
        }
    
        var selectoncallback = function(returndata) {			
            
            // jsonì€ ë¡œê·¸ ì°ì–´ë³´ë©´ ì´ìƒí•œ ìƒíƒœë¡œ ë˜ì ¸ì§€ê³  ìˆìœ¼ë‹ˆê¹Œ stringfy ì‘ì—… í•„ìˆ˜
            console.log( JSON.stringify(returndata) );
    
            popupinit(returndata.noticesearch);
    
            // ëª¨ë‹¬ íŒì—…
            gfModalPop("#layer1");
    
        }
    
        callAjax("/mngNot/noticeselectone.do", "post", "json", false, param, selectoncallback) ;
    
    }
    ```

- Java ë‹¨ - Controller (`/mngNot/controller/MngNotController.java`)

  - @RequestMapping(â€œnoticeselectone.doâ€) ì‘ì„±

    - http ì‘ë‹µì˜ ë°”ë”” ì˜ì—­ì— HTML ì´ ì•„ë‹ˆë¼ ë°ì´í„°(json) ë„˜ê¸¸ ë•, @ResponseBody ì‚¬ìš©

    - Map ë°ì´í„°ëŠ” ì´ˆê¸°í™”í•  ë•Œ HashMap ì¨ì•¼ ë¨, Map ì˜ ì‚¬ì´Œ ê°œë…

      ```java
      @RequestMapping("noticeselectone.do")
      @ResponseBody
      public Map<String, Object> noticeselectone(Model model, @RequestParam Map<String, Object> paramMap, HttpServletRequest request,
                                                 HttpServletResponse response, HttpSession session) throws Exception {
      
          logger.info("+ Start " + className + ".noticeselectone");
          logger.info("   - paramMap : " + paramMap);
      
          // Controller  Service  Dao  SQL
          NoticeModel noticesearch = mngNotService.noticeselectone(paramMap);
      
          Map<String, Object> returnmap = new HashMap<String, Object>();
      
          returnmap.put("noticesearch", noticesearch);
      
          logger.info("+ End " + className + ".noticeselectone");
      
          return returnmap;
      }   
      ```

- ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ íŒŒì¼ì— ì‘ì„±ëœ ë‚´ìš© ë°”íƒ•ìœ¼ë¡œ ë©”ì„œë“œ ë§Œë“¤ê¸° (ì„œë¹„ìŠ¤ íŒŒì¼ ì‘ì„±)

  - `/mngNot/service/MngNotService.java`

    ```java
    public interface MngNotService {
    
        ...
        
        /** í•œê±´ ì¡°íšŒ */
        public NoticeModel noticeselectone(Map<String, Object> paramMap) throws Exception;
        
        ...
    
    }
    ```

  - `/mngNot/dao/MngNotDao.java`

    ```java
    public interface MngNotDao {
    
    	...
    	
    	/** í•œê±´ ì¡°íšŒ */
    	public NoticeModel noticeselectone(Map<String, Object> paramMap) throws Exception;
    	
    	...
            
    }
    ```

  - `/mngNot/service/MngNotServiceImpl.java`

    ```java
    @Service
    public class MngNotServiceImpl implements MngNotService {
    
    	// Set logger
    	private final Logger logger = LogManager.getLogger(this.getClass());
    	
    	// Get class name for logger
    	private final String className = this.getClass().toString();
    	
    	@Autowired
    	MngNotDao mngNotDao;
    	
    	...
    	
    	/** í•œê±´ ì¡°íšŒ */
    	public NoticeModel noticeselectone(Map<String, Object> paramMap) throws Exception {
    		
    		return mngNotDao.noticeselectone(paramMap);
    	}
        
    }
    ```

- SQL ë‹¨ (`/src/main/resources/sql/MngNot/MngNotMapper.xml`)

  - ìœ„ Java ë‹¨ê¹Œì§€ ì‘ì„±í•œ ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìƒˆë¡œìš´ `<SELECT>` ì‘ì„±

    ```xml
    <select id="noticeselectone" resultType="kr.happyjob.study.mngNot.model.NoticeModel">
        select nt.notice_del_yn
        ,nt.loginID
        ,nt.notice_no
        ,nt.notice_title
        ,nt.notice_date
        ,nt.notice_cont
        ,nt.file_no
        ,fi.file_name
        ,fi.logic_path
        ,fi.physic_path
        ,fi.file_size
        ,fi.exten
        ,ui.name
        from tb_notice nt
        inner join tb_userinfo ui on ui.loginID = nt.loginID
        left outer join tb_file fi on fi.file_no = nt.file_no  
        where nt.notice_no =  #{notice_no}               
    </select>
    ```

  - `Mapper.xml` íŒŒì¼ ìˆ˜ì •í–ˆìœ¼ë‹ˆê¹Œ, ì»´íŒŒì¼í•˜ê³  í™”ë©´ í™•ì¸í•˜ê¸°

    - ì´ ë•Œ ì½˜ì†”ì°½ì— ì¡°ê±´ì— ë§ëŠ” json ë°ì´í„° ë„˜ì–´ì˜¤ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤ë©´ (json ì•ˆì— json ì´ ì¤‘ì²©ëœ í˜•íƒœ), ì´ì œ ë„˜ì–´ì˜¨ ë°ì´í„°ë¥¼ í™”ë©´ì— ë„ìš°ëŠ” ì‘ì—…ë§Œ ë‚¨ìŒ

- JSPë‹¨ (`/view/mngNot/noticelist.jsp`)

  - [ìˆ˜ì •], [ì‚­ì œ] ì˜ ê²½ìš° notice_no ë¥¼ PKë¡œ ê°–ëŠ” ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ DBì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ê¸° ë•Œë¬¸ì—, JSP íŒŒì¼ `<form>` ë‚´ë¶€ ìµœìƒë‹¨ì— 2ë²ˆì§¸ hidden ë§Œë“¤ê¸° 

    ```jsp
    <body>
    <form id="myForm" action=""  method="">
        ...
    	<input type="hidden" id="notice_no"  name="notice_no"  />
        ...
    ```

  - `function popupinit(object)` elseë¬¸ ë‚´ë¶€ì— ìƒˆë¡œ ì‘ì„±í•œ hidden (notice_no) ì— ëŒ€í•´ ì½”ë“œ ì‘ì„±

  - [ì €ì¥] ë²„íŠ¼(id=btnSave) ëˆ„ë¥´ë©´ [ì‹ ê·œë“±ë¡], [ìˆ˜ì •] ê¸°ëŠ¥ ëª¨ë‘ ì‘ë™í•˜ë„ë¡ `function fn_save()` ì‘ì„±

    - ëª©ë¡ ì¡°íšŒí•  ë•Œ ì œì™¸í•˜ë©´ ë¬´ì¡°ê±´ json ë°ì´í„°ê°€ ì˜¤ê°€ë‹ˆê¹Œ, ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë• ë¬´ì¡°ê±´ param ì„ ì–¸ (`var param`)

    - ì½œë°±í•¨ìˆ˜ ì„ ì–¸í•œ ë¶€ë¶„ì— ifì¡°ê±´ë¬¸ìœ¼ë¡œ "ì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.", "ì˜¤ë¥˜ê°€ ë°œìƒ ë˜ì—ˆìŠµë‹ˆë‹¤." alrert ë„ìš°ëŠ” ì½”ë“œ ì‘ì„±, ì°½ì„ ë‹«ê³  ëª©ë¡ ì¬ì¡°íšŒí•˜ëŠ” ë¡œì§ë„ ì¶”ê°€

      ```javascript
      function fn_save() {
      		
          if ( ! fn_Validate() ) {
              return;
          }
      
          var param = {
              action : $("#action").val(),
              notice_no : $("#notice_no").val(),
              notice_title : $("#notice_title").val(),
              notice_cont : $("#notice_cont").val()
          }
      
          var savecollback = function(reval) {
              console.log( JSON.stringify(reval) );
      
              if(reval.returncval > 0) {
                  alert("ì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                  gfCloseModal();
      
                  if($("#action").val() == "U") {
                      fn_noticelist($("#pageno").val());
                  } else {
                      fn_noticelist();
                  }
              }  else {
                  alert("ì˜¤ë¥˜ê°€ ë°œìƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");				
              }
          }
      
          //callAjax("/mngNot/noticesave.do", "post", "json", false, param, savecollback) ;
          callAjax("/mngNot/noticesave.do", "post", "json", false, $("#myForm").serialize() , savecollback) ;
      
      }
      ```

- Java ë‹¨ - Controller (`/mngNot/controller/MngNotController.java`)

  - @RequestMapping(â€œnoticesave.doâ€) ì‘ì„±

    - ë‚´ë¶€ì— if ì¡°ê±´ë¬¸ìœ¼ë¡œ [ì‹ ê·œë“±ë¡] , [ìˆ˜ì •], [ì‚­ì œ] í•œêº¼ë²ˆì— ê°€ëŠ¥í•˜ë„ë¡ ê¸°ëŠ¥ êµ¬í˜„

    - ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë„£ì–´ì•¼ í•˜ë‹ˆê¹Œ, ë¡œê·¸ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸ì…˜ ê´€ë ¨ ì½”ë“œë„ ê¸ì–´ì™€ì„œ ë„£ê¸°

      ```java
      @RequestMapping("noticesave.do")
      @ResponseBody
      public Map<String, Object> noticesave(Model model, @RequestParam Map<String, Object> paramMap, HttpServletRequest request,
                                            HttpServletResponse response, HttpSession session) throws Exception {
      
          logger.info("+ Start " + className + ".noticesave");
          logger.info("   - paramMap : " + paramMap);
      
          String action = (String) paramMap.get("action");
      
          paramMap.put("loginid", (String) session.getAttribute("loginId"));
      
      
          int returncval = 0;
      
          if("I".equals(action)) {
              returncval = mngNotService.noticeinsert(paramMap);
          } else if("U".equals(action)) {
              returncval = mngNotService.noticeupdate(paramMap);
          } else if("D".equals(action)) {
              returncval = mngNotService.noticedelete(paramMap);
          }      
      
          Map<String, Object> returnmap = new HashMap<String, Object>();
      
          returnmap.put("returncval", returncval);
      
          logger.info("+ End " + className + ".noticesave");
      
          return returnmap;
      }    
      ```

- ìœ„ Controller ë³€ê²½ ì‚¬í•­ì„ ì„œë¹„ìŠ¤, ë‹¤ì˜¤, ì„í”Œì—ë„ ë°˜ì˜

  - `/mngNot/service/MngNotService.java`

    ```java
    public interface MngNotService {
    
    	...
    	
    	/** ë“±ë¡ */
    	public int noticeinsert(Map<String, Object> paramMap) throws Exception;
    	
    	/** ìˆ˜ì • */
    	public int noticeupdate(Map<String, Object> paramMap) throws Exception;
    	
    	/** ì‚­ì œ */
    	public int noticedelete(Map<String, Object> paramMap) throws Exception;
    	
    }
    ```

  - `/mngNot/dao/MngNotDao.java`

    ```java
    public interface MngNotDao {
    
    	...
    	
    	/** ë“±ë¡ */
    	public int noticeinsert(Map<String, Object> paramMap) throws Exception;
    	
    	/** ìˆ˜ì • */
    	public int noticeupdate(Map<String, Object> paramMap) throws Exception;
    	
    	/** ì‚­ì œ */
    	public int noticedelete(Map<String, Object> paramMap) throws Exception;
    }
    ```

  - `/mngNot/service/MngNotServiceImpl.java`

    ```java
    @Service
    public class MngNotServiceImpl implements MngNotService {
    
    	// Set logger
    	private final Logger logger = LogManager.getLogger(this.getClass());
    	
    	// Get class name for logger
    	private final String className = this.getClass().toString();
    	
    	@Autowired
    	MngNotDao mngNotDao;
    	
    	...
    	
    	/** ë“±ë¡ */
    	public int noticeinsert(Map<String, Object> paramMap) throws Exception {
    		return mngNotDao.noticeinsert(paramMap);
    	}
    	
    	/** ìˆ˜ì • */
    	public int noticeupdate(Map<String, Object> paramMap) throws Exception {
    		return mngNotDao.noticeupdate(paramMap);
    	}
    	
    	/** ì‚­ì œ */
    	public int noticedelete(Map<String, Object> paramMap) throws Exception {
    		return mngNotDao.noticedelete(paramMap);
    	}
    	
    }
    ```

- SQL ë‹¨ (`/src/main/resources/sql/MngNot/MngNotMapper.xml`)

  - ìœ„ Java ë‹¨ê¹Œì§€ ì‘ì„±í•œ ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìƒˆë¡œìš´ `<INSERT>` ì‘ì„±

    - `<selectkey>` ì—ì„œ `keyProperty=â€noâ€` ë¡œ ì‘ì„±í•œ ê²ƒì€, [ë§ˆì´ë°”í‹°ìŠ¤ ë¬¸ë²•ì—ì„œ í™œìš©](https://velog.io/@cheshirehyun/SelectKey-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0)í•˜ê¸° ìœ„í•¨

    - Oracle ì˜ NVL í•¨ìˆ˜ê°€ MySQLì—ì„œ ifnull í•¨ìˆ˜ë¡œ ëŒ€ì²´ë¨

      ```xml
      <insert id="noticeinsert">
          <selectKey resultType="int" keyProperty="no" order="BEFORE">
              select ifnull(max(notice_no),0) + 1 from tb_notice
          </selectKey>   
          insert into tb_notice
          (
          notice_no
          , notice_del_yn
          , loginID
          , notice_title
          , notice_cont
          , notice_date
          , file_no
          )
          values (
          #{no} 
          ,'N'
          ,#{loginid} 
          ,#{notice_title} 
          ,#{notice_cont} 
          ,now()
          ,0
          )
      </insert>
      ```

  - `<UPDATE>` ë„ ì‘ì„±

    - í•œê±´ ì¡°íšŒ íŒì—…ì°½ì´ ë–´ì„ ë•Œ, [ì €ì¥] ë²„íŠ¼ í´ë¦­í•˜ë©´ ìˆ˜ì •í•œ ë°ì´í„°ê°€ DBë¡œ ë„˜ì–´ê°€ëŠ” ê¸°ëŠ¥

      ```xml
      <update id="noticeupdate">
          update tb_notice
          set notice_title =  #{notice_title}   
          , notice_cont =  #{notice_cont}   
          , notice_date =  now()      
          where  notice_no =  #{notice_no}  
      </update>
      ```

  - `<DELETE>` ë„ ì‘ì„±

    - í•œê±´ ì¡°íšŒ íŒì—…ì°½ì´ ë–´ì„ ë•Œ, [ì‚­ì œ] ë²„íŠ¼ í´ë¦­í•˜ë©´ ë°ì´í„°ê°€ DBì—ì„œ ì‚­ì œë˜ëŠ” ê¸°ëŠ¥

    - ì´ ë•Œ, id ëŠ” Controller íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì‚¬ì‹¤ì— ìœ ì˜

      ```xml
      <update id="noticedelete">
          update tb_notice
          set notice_del_yn =  'Y'
          where  notice_no =  #{notice_no}  
      </update>
      
      <delete id="noticedeleteold">
          delete from tb_notice
          where  notice_no =  #{notice_no}  
      </delete>
      ```

    - `/view/mngNot/noticelist.jsp` ì—ì„œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ì„ ìœ„í•œ `function fRegisterButtonClickEvent()` caseë¬¸ë„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •

      ```javascript
      function fRegisterButtonClickEvent() {
          $('a[name=btn]').click(function(e) {
              e.preventDefault();
      
              var btnId = $(this).attr('id');
      
              switch (btnId) {
                  case 'btnSearch' :
                      fn_noticelist();
                      break;
                  case 'btnSave' :
                      fn_save();
                      break;	
                  case 'btnDelete' :
                      $("#action").val("D");	
                      fn_save();
                      break;	
                  case 'btnClose' :
                  case 'btnCloseDtlCod' :
                      gfCloseModal();
                      break;
              }
          });
      }
      ```

- `Mapper.xml` íŒŒì¼ ìˆ˜ì •í–ˆìœ¼ë‹ˆê¹Œ, ì»´íŒŒì¼í•˜ê³  í™”ë©´ í™•ì¸í•˜ê¸°



---



2-2-4. ì¶”ê°€ì ì¸ ê¸°ëŠ¥ê°œì„ 



**<í˜ì´ì§€ë„¤ì´ì…˜ ìˆ˜ì •>**

ìœ„ ìƒíƒœì—ì„œëŠ” íŠ¹ì • ê¸€ì„ ìˆ˜ì •í–ˆì„ ë•Œ, ìˆ˜ì •í•œ ê²Œì‹œê¸€ì´ ì›ë˜ ìˆë˜ 1í˜ì´ì§€ ìë¦¬ì—ì„œ 2í˜ì´ì§€ ìë¦¬ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìˆ˜ì • ì™„ë£Œí•˜ë©´ ì‘ì—…í•˜ë˜ í˜„ì¬ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ ìˆ˜ì •

ì¼ë‹¨ noticelist.jsp íŒŒì¼ì—ì„œ 3ë²ˆì§¸ hidden ì„ ì‘ì„±. í˜„ì¬ ë³´ê³  ìˆëŠ” í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ë°±ì—…í•˜ëŠ” ê³³. ` <input type="hidden" id="pageno" name="pageno" /> `

ê°™ì€ íŒŒì¼ ìŠ¤í¬ë¦½íŠ¸ ì˜ì—­ì— var paginationHtml ì— $("#pageno").val(pagenum); ì½”ë“œ ì¶”ê°€í•˜ê³ ,

var savecollback ë¶€ë¶„ ifë¬¸ ì•ˆì— ë˜ ë‹¤ë¥¸ ifë¬¸ ì¶”ê°€í•˜ì—¬ ìˆ˜ì • ì €ì¥í–ˆì„ ë•Œ, #pageno ì˜ ê°€ì ¸ì˜¤ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´(else) fn_noticelist() ë™ì‘í•´ì„œ ê³µì§€ì‚¬í•­ì˜ ë””í´íŠ¸ í™”ë©´ ë³´ì—¬ì£¼ë„ë¡ ì½”ë“œ ìˆ˜ì •

 

<ê¸€ ì‚­ì œë˜ë©´ ì‚­ì œì—¬ë¶€ ë°ì´í„° N ì—ì„œ Y ë¡œ ë°”ê¾¸ë„ë¡ ìˆ˜ì •>

.xml íŒŒì¼ì—ì„œ update íƒœê·¸ ì¶”ê°€í•´ì„œ id=noticedelete ë„£ì–´ì„œ ì‘ì„±

 

**<Validation ì²´í¬>**

ìœ„ì˜ ìƒíƒœì—ì„œ ì œëª©, ë‚´ìš©ì„ ë¹„ì–´ìˆëŠ” ê°’ìœ¼ë¡œ ì €ì¥í•˜ë©´ ê³µë°± ìƒíƒœë¡œ ì €ì¥ì´ ë˜ì–´ë²„ë¦¼. ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ noticelist.jsp function fn_save() ì•ˆì— ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ë¡œì§ ì¶”ê°€í•˜ê³  function fn_Validate() ì‘ì„± (ê°™ì€ íŒŒì¼ ë‚´ validation ì²´í¬ë¼ëŠ” ì£¼ì„ìœ¼ë¡œ ì½”ë“œ ValidationGrpCode() ì •ë¦¬ë˜ì–´ ìˆìŒ â€¦ ìƒìœ„ ë¡œì§ì€ common.js íŒŒì¼ checkNotEmpty ì—ì„œ í™•ì¸ ê°€ëŠ¥)

 

**<$(â€œ#myFormâ€).serialize()>**

`function fn_save()` ëë‹¨ì— callAjax("/mngNot/noticesave.do", "post", "json", false, param, savecollback) ; ë¶€ë¶„ ìˆ˜ì •!  ì½”ë“œì—ì„œ param ë¶€ë¶„ì„ $(â€œ#myFormâ€).serialize() ë¡œ ê³ ì¹˜ê¸°

ì´ê±¸ ì“°ëŠ” ì´ìœ ëŠ” ì…ë ¥í•­ëª©ì´ 30~40ê°œ ë  ë•Œ, var param ì— í•˜ë‚˜í•˜ë‚˜ ì•ˆì ì–´ì¤˜ë„ serialize() ë¡œ ë˜˜ë˜˜ ë§ì•„ì„œ ë°ì´í„° ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŒ (ì‚¬ì‹¤ ìƒ param ì„ ì–¸ì„ ì•ˆì¨ì¤˜ë„ ë¨)

ì£¼ì˜, `<form>` íƒœê·¸ ì•ˆì— name ì•ˆì¤€ ì• ë“¤ì€ ì •ë³´ ì•ˆë„˜ì–´ê°!





### ğŸ—‚ï¸ [CRUD - CREATE, UPDATE, DELETE êµ¬í˜„ëœ ìµœì¢… ì†ŒìŠ¤ì½”ë“œ í™•ì¸](../practices/0609_CRUD_CUD)



