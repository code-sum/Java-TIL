# ✅ CRUD - III

> - 학습목표 : 전자정부표준 프레임워크(eGovFramework)로 제작된 프로젝트에서 CRUD 구현하는 로직을 배움
>
> 1. 개발순서 개요
> 2. 게시글 CRUD
> 3. 파일 CRUD





## 3. 파일 CRUD

> 파일관리(upload, download)를 위한 기능구현



- UPDATE 기능구현 로직 (2X2 = 4가지 경우의 수 발생)

|                   | 수정파일O (파일B)       | 수정파일X |
| ----------------- | ----------------------- | --------- |
| 기존파일O (파일A) | 파일A 삭제 ➡️ 파일B 처리 | -         |
| 기존파일X         | 파일B 처리              | -         |

- INSERT 와 거의 비슷하지만, 위와 같이 4가지 경우의 수 고려하여 설계

  - 조건1 : 기존에 첨부된 파일이 있는지(기존파일O), 아닌지(기존파일X)

  - 조건2 : 수정 작업할 때 첨부된 파일이 있는지(수정파일O), 아닌지(수정파일X)

- [수정] 버튼 눌렀을 때, 데이터 1건조회 되는 기능 먼저 구현
  
  - 글번호 누르면 글상세 팝업이 뜨고, 글제목 누르면 파일상세 팝업이 뜨도록 JSP 파일 href 부분 먼저 수정
  
  - <script> 에서 function fn_selectonefile(no) 작성
  
    - popupinitfile() 로 초기화
    - function popupinitfile(object) else문 내부에($("#file_notice_title").val(object.notice_title); 윗부분) json 데이터로 받아오는 항목들 잡는 코드 작성
    - var inserthtml = “<a href='javascript:filedownload()'>”;
       inserthtml += “<img src=’’ + object.logic_path + ‘’ />”;
  
       이 부분에 if문 넣어서 파일 이름이 없을 때(빈값, null, undefined) 예외처리하도록 하고
       var selfile, var selfilearr, var lastindex 그리고 그 아래 if/else 코드 가져와서 우리가 구현하고 있는 기능에 맞게 구분 (파일 확장자가 .sql 로 뽑히면 안되니까, 이걸 수정해주는 작업)
  
       Interthtml += “</a>”
    - 파일 미리보기를 위한 $("#previewdiv").empty().append(Interthtml); 입력$("#btnDeleteFile").show();
    - $("#action").val("U");



- NAS 관련 설정

  - Tomcat 에게 NAS 사용할 예정이라고 알려주기

    - Server 더블클릭 > Module 클릭 > Add External Web Module 창에 아래와 같이 Path 설정

      ![그림1](0612_CRUD3.assets/그림1.png)

    - 위 상태로 서버 설정 창 저장한 다음, 서버 Stop 했다가 다시 Run

    - 파일탐색기/\\\DESKTOP-40KHJBQ/sharefolder/FileRepository 에 이미지 1장(mysql.jpg) 넣고

    - 브라우저 창에 `localhost/serverfile/파일명.확장자명`(http://localhost/serverfile/mysql.jpg) 치면 공유한 파일이 보임







### 🗂️ [파일 CRUD 구현된 최종 소스코드 확인]()



